#!/bin/bash
set -euo pipefail
DB_NAME="laravel"
BACKUP_DIR="/var/backups/postgresql"
TS="$(date +%Y%m%d_%H%M%S)"
mkdir -p "$BACKUP_DIR"
/usr/bin/sudo -u postgres pg_dump "$DB_NAME" | gzip > "$BACKUP_DIR/backup_${DB_NAME}_${TS}.sql.gz"
if command -v aws >/dev/null && aws sts get-caller-identity >/dev/null 2>&1; then
  aws s3 cp "$BACKUP_DIR/backup_${DB_NAME}_${TS}.sql.gz" "s3://your-backup-bucket/database-backups/" --sse AES256 || true
fi
echo "OK: $BACKUP_DIR/backup_${DB_NAME}_${TS}.sql.gz"
